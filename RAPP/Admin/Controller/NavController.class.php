<?phpnamespace Admin\Controller;use Admin\Controller;class NavController extends RootController{	public function index(){		$catelist = D('NavCate')->get_cate_list(0);		foreach($catelist as &$val){			$val['sort'] = end(explode(',',$val['sort']));		}		$this->assign('catelist',$catelist);		$this->display();	}    /**     * 新增链接     * @author zjf ${date}     */	public function add(){		if(IS_POST){			$res = D('NavCate')->add_cate($_POST['id'],array('name_cn'=>$_POST['name_cn'],'name_en'=>$_POST['name_en'],'is_show'=>$_POST['is_show'],'target'=>$_POST['target'],'url'=>$_POST['url']));			if($res['status']){				$this->redirect('Nav/index');			}else{				$this->error('添加失败！');			}		}	}	/**	 * 保存,显示,编辑分类	 */	public function edit(){		if(IS_POST){			//var_dump($_POST);exit();			$res = M('NavCate')->save($_POST);			if(false !== $res){                $this->redirect('Nav/index');			}else{                $this->error('编辑失败！');			}		}else{			$page = M('NavCate')->find($_GET['id']);			$this->assign('page',$page);			$this->display();		}	}	/**	 * 删除一个分类	 * =0(删除失败),=1(删除成功),=2(当前分类下有文章),=3(当前分类有子类)	 */	public function ajax_del_cate(){		$ids = D("NavCate")->get_child_ids($_POST['id']);		$res = M('NavCate')->where(array('id'=>array('in',$ids)))->delete();		$this->ajaxReturn(array('status'=>1,'ids'=>explode(',',$ids)));	}	/**	 *ajax设置排序	 *@create 2014-12-16	 *@author zjf	 */	public function ajax_setsort(){		$res = D('NavCate')->update_sort($_POST['id'],$_POST['sort']);		$this->ajaxReturn($res);	}	/**	 * ajax更新导航网址	 */	public function ajax_update_url(){		$res = D('NavCate')->save_item($_POST);		$this->ajaxReturn($res);	}}