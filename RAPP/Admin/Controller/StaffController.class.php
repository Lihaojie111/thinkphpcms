<?phpnamespace Admin\Controller;use Admin\Controller;class StaffController extends RootController{	public function index(){	}	/**	 *新闻列表	 *@create 2014-12-19	 *@author zjf	 */	public function lists(){		//载入分类		$this->assign('catelist',D('StaffCate')->get_cate_list(0));		//当前分类id		$_GET['cate_id'] = $_GET['cate_id']?$_GET['cate_id']:0;		$this->assign('cate_id',$_GET['cate_id']);		$ids = D('StaffCate')->get_child_ids($_GET['cate_id']);		//分页		$Staff = M('Staff');		$where['pid'] = array('in',$ids);		if($_GET['title']){			$where['title'] = array('like','%'.$_GET['title'].'%');		}		$count = $Staff->where($where)->count();		$Page = new \Think\Page($count,30);		$show = $Page->show();		//主数据		$alist = $Staff->where($where)->field(true)->order('is_stick desc,sort,id desc')->limit($Page->firstRow.','.$Page->listRows)->select();		$catelist = D('StaffCate')->get_cate_list(0);		foreach($alist as &$val){			foreach($catelist as &$cate){				if($cate['id'] == $val['pid']){					$val['cate'] = $cate['name'];				}			}		}		$this->assign('alist',$alist);		$this->assign('pages',$show);		$this->display();		}	/**	 *添加人员	 *@create 2014-12-19	 *@author zjf	 */	public function add(){		if(IS_POST){			$_POST['publish_time'] = NOW_TIME;			$_POST['edit_time'] = NOW_TIME;			$res = D('Staff')->add_item($_POST);			if(!$res['status']){				$this->error($res['error']);			}else{				$this->redirect('Staff/lists',array('cate_id'=>$_POST['pid']),2,'恭喜你，发布成功！');			}		}else{			//载入分类			$catelist = D('StaffCate')->get_cate_list(0);			$this->assign('catelist',$catelist);			//当前分类			if(!isset($_GET['cate_id'])){				$_GET['cate_id'] = $catelist[0]['id'];			}			$this->display();		}	}	/**	 *编辑文章	 *@create 2014-12-19	 *@author zjf	 */	public function edit(){		if(IS_POST){			$_POST['publish_time']=strtotime($_POST['publish_time'].' '.date('H:i:s'));			$_POST['edit_time'] = time();			$res = D('Staff')->save_item($_POST);			if(!$res){				$this->error($res['error']);			}else{				$this->redirect('Staff/lists',array_decode($_GET['jump_url']),2,'编辑成功！');			}		}else{			//载入分类			$this->assign('catelist',D('StaffCate')->get_cate_list(0));			$res = D('Staff')->get_item(array('id'=>$_GET['id']),0);			$this->assign('page',$res);			$this->display();		}	}	/**	 *ajax进行分词	 *@create 2015-1-13	 *@author zjf	 */	public function ajax_split_words(){		$pa = new \Vendor\phpanalysis\phpanalysis();		$pa->SetSource($_POST['title']);		//设置分词属性		$pa->resultType = 2;		$pa->differMax  = true;		$pa->differFreq = true;		$pa->StartAnalysis();		//获取你想要的结果		$b = $pa->GetFinallyResult(',');		$key=trim($b,',');		if($key){			$this->ajaxReturn(array('status'=>1,'keywords'=>$key));		}else{			$this->ajaxReturn(array('status'=>0));		}	}	/**	 *ajax更新文章pid	 *@create 2014-12-19	 *@author zjf	 */	public function ajax_update_pid(){		return D('Staff')->save_item(array('id'=>$_POST['id'],'pid'=>$_POST['pid']));	}	/**	 *ajax删除文章	 *@create 2014-12-19	 *@author zjf	 */	public function ajax_del(){		$res = D('Staff')->del_item(array('id'=>$_POST['id']));		$this->ajaxReturn($res);	}	/**	 *ajax置顶文章	 *@create 2014-12-19	 *@author zjf	 */	public function ajax_stick(){		$res = D('Staff')->save_item(array('id'=>$_POST['id'],'edittime'=>time(),'is_stick'=>1));		$this->ajaxReturn($res['status']);	}	/**	 *取消置顶文章	 *@create 2014-12-19	 *@author zjf	 */	public function ajax_unstick(){		$res = D('Staff')->save_item(array('id'=>$_POST['id'],'is_stick'=>0));		$this->ajaxReturn($res['status']);	}	/**	 *ajax设置排序	 *@create 2014-12-16	 *@author zjf	 */	public function ajax_setsort(){		$data['id'] = $_POST['id'];		$data['sort'] = $_POST['sort'];		$res = D('Staff')->save_item($data);		$this->ajaxReturn($res);	}}