<extend name="Include:mother" /><block name="content"><div class="g_tab">	<div class="title">荣誉列表</div></div><div class="g_operation">	<div class="lft">		<form action="" method="get" name="form1">			选择分类：			<select class="select_group" name="cate_id">				<option value="">全部</option>				<volist name="catelist" id="item">					<eq name="item.id" value="$cate_id">						<option value="{$item.id}" selected="selected">{$item.pre}{$item.name}</option>						<else/>						<option value="{$item.id}">{$item.pre}{$item.name}</option>					</eq>				</volist>			</select>&nbsp;&nbsp;			标题搜索：			<input class="text" name="title" type="text" value="{$Think.get.title}"/>			&nbsp;			<input class="submit" type="submit" value="搜索" />		</form>	</div>	<div class="rgt">		<div class="btn_group">			<dl>				<dd><a href="{:U('Honor/add',array('cate_id'=>$_GET['cate_id']))}">新增荣誉</a></dd>			</dl>			<div class="clear"></div>		</div>	</div>	<div class="clear"></div></div><table class="g_list">	<thead>	<tr>		<th width="40">ID</th>		<th>标题</th>		<th>图片</th>		<th>分类</th>		<th>排序</th>		<th>发布时间</th>		<th>操作</th>	</tr>	</thead>	<tbody>	<volist name='alist' id='vo'>		<tr class="tr_{$vo.id}">			<td>{$vo.id}</td>			<td>{$vo.title}</td>			<td><img src="{$vo.thumb}" height="40" /></td>			<td>{$vo.cate}</td>			<td>				<input class="text" type="text" name="sort" value="{$vo.sort}" old-sort="{$vo.sort}" data-id="{$vo.id}" style="width:40px;" />				<a href="#" onclick="return update_sort_one({$vo.id},this)">更新</a>			</td>			<td>{$vo.publish_time|date="Y-m-d h:i:s",###}</td>			<td>				<a href="{:U('Honor/edit',array('cate_id'=>$vo['pid'],'id'=>$vo['id'],'jump_url'=>array_encode($_GET)))}">编辑</a>&nbsp;&nbsp;&nbsp;				<a href="#" onclick="return del({$vo.id})">删除</a>&nbsp;&nbsp;&nbsp;			</td>		</tr>	</volist>	</tbody></table><div class="g_btns">	<a class="btn" href="#" onclick="return update_sort();">更新排序</a></div><div class="g_pages">	{$pages}</div><script>	//选择分类后提交表单	$("select.select_group").change(function(){		$("form[name=form1]").submit();	});	//ajax删除荣誉	function del($id){		$k.dialog({text:'确认删除？',title:'删除荣誉'},function(){			$.ajax({				type:"post",				url: "{:U('Honor/ajax_del')}",				data: {id:$id},				success: function(data){					if(data)					{						$k.text({text:'删除成功！',delay:1200},function(){							$(".tr_"+$id).remove();						});					}else					{						$k.text({text:'删除失败！',delay:1200});					}				}			});		});		return false;	}	//ajax置顶荣誉	function stick($id){		$k.dialog({text:'确认置顶？'},function(){			$.ajax({				type:"post",				url: "{:U('Honor/ajax_stick')}",				data: {id:$id},				success: function(data){					if(data)					{						$k.text({text:'置顶成功！',delay:1200},function(){							window.location.reload();						});					}else					{						$k.text({text:'置顶失败！',delay:1200});					}				}			});		});		return false;	}	//ajax取消置顶荣誉	function unstick($id){		$k.dialog({text:'确认取消置顶？'},function(){			$.ajax({				type:"post",				url: "{:U('Honor/ajax_unstick')}",				data: {id:$id},				success: function(data){					if(data)					{						$k.text({text:'取消置顶成功！',delay:1200},function(){							window.location.reload();						});					}else{						$k.text({text:'取消置顶失败！',delay:1200});					}				}			});		});		return false;	}	//更新单条排序	function update_sort_one($id,obj){		var old_sort = $(obj).prev().attr('old-sort');		var now_sort = $(obj).prev().val();		if(old_sort == now_sort){			$k.text({text:"请先调整排序值！",delay:1200});			return false;		}else{			$.ajax({				type:"post",				url:"{:U('Honor/ajax_setsort')}",				data:{id:$id,sort:now_sort},				success:function(data){					if(data['status']){						$k.text({text:"更新成功！",delay:1200},function(){							window.location.reload();						});					}				}			});		}		return false;	}	function update_sort(){		$last_id = $("input[name=sort]").last().attr('data-id');		$("input[name=sort]").each(function(){			var $id = $(this).attr('data-id'),$sort = $(this).val(),$old_sort = $(this).attr('old_sort');			if($old_sort!=$sort){				$.ajax({					type:"post",					url:"{:U('Honor/ajax_setsort')}",					data:{id:$id,sort:$sort},					success:function(data){						if(data['status'] && $id == $last_id){							$k.text({text:"更新成功！",delay:1200},function(){								window.location.reload();							});						}					}				});			}		});		return false;	}</script></block>