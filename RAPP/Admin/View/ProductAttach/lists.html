<extend name="Include:mother" /><block name="content"><div class="g_tab">    <div class="title">产品特惠</div></div><div class="g_operation">    <div class="lft"></div>    <div class="rgt">        <div class="btn_group">            <dl>                <dd><a href="{:U('ProductAttach/add')}">新增特惠</a></dd>            </dl>            <div class="clear"></div>        </div>    </div>    <div class="clear"></div></div><table class="g_list">    <thead>    <tr>        <th width="40">ID</th>        <th width="280">优惠标题</th>        <th>排序</th>        <th>备注</th>        <th width="140">操作</th>    </tr>    </thead>    <tbody>    <volist name='lists' id='vo'>        <tr class="tr_{$vo.id}">            <td>{$vo.id}</td>            <td>{$vo.name}</td>            <td>                <input class="text" type="text" name="sort" value="{$vo.sort}" old-sort="{$vo.sort}" data-id="{$vo.id}" style="width:40px;" />                <a href="#" onclick="return update_sort_one({$vo.id},this)">更新</a>            </td>            <td>{$vo.remark}</td>            <td>                <a href="{:U('ProductAttach/edit',array('id'=>$vo['id']))}">编辑</a>&nbsp;&nbsp;&nbsp;                <a href="#" onclick="return del({$vo.id})">删除</a>            </td>        </tr>    </volist>    </tbody></table><div class="g_btns">    <a class="btn" href="#" onclick="return update_sort();">更新排序</a></div><script>    //ajax删除文章    function del($id){        $k.dialog({text:'删除后该产品特惠将同步删除，确认删除？',title:'删除特惠'},function(){            $.ajax({                type:"post",                url: "{:U('ProductAttach/ajax_del')}",                data: {id:$id},                success: function(data){                    if(data)                    {                        $k.text({text:'删除成功！',delay:1200},function(){                            $(".tr_"+$id).remove();                        });                    }else                    {                        $k.text({text:'删除失败！',delay:1200});                    }                }            });        });        return false;    }    //更新单条排序    function update_sort_one($id,obj){        var old_sort = $(obj).prev().attr('old-sort');        var now_sort = $(obj).prev().val();        if(old_sort == now_sort){            $k.text({text:"请先调整排序值！",delay:1200});            return false;        }else{            $.ajax({                type:"post",                url:"{:U('ProductAttach/ajax_setsort')}",                data:{id:$id,sort:now_sort},                success:function(data){                    if(data['status']){                        $k.text({text:"更新成功！",delay:1200},function(){                            window.location = window.location;                        });                    }                }            });        }        return false;    }    function update_sort(){        $last_id = $("input[name=sort]").last().attr('data-id');        $("input[name=sort]").each(function(){            var $id = $(this).attr('data-id'),$sort = $(this).val(),$old_sort = $(this).attr('old_sort');            if($old_sort!=$sort){                $.ajax({                    type:"post",                    url:"{:U('ProductAttach/ajax_setsort')}",                    data:{id:$id,sort:$sort},                    success:function(data){                        if(data['status'] && $id == $last_id){                            $k.text({text:"更新成功！",delay:1200},function(){                                window.location = window.location;                            });                        }                    }                });            }        });        return false;    }</script></block>