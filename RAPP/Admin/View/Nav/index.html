<extend name="Include:mother" /><block name="content">    <div class="clearfix">        <div class="float-left">            <div class="u-breadcrumb">                <a class="back" href="javascript:window.location.reload()" ><span class="fa fa-repeat"></span> 刷新</a>                <span class="name">导航设置</span>            </div>        </div>        <div class="float-right">            <a href="#" role="button" class="btn btn-primary btn-sm" onclick="return alert_win('根目录',0);"><i class="fa fa-plus"></i> 新增顶级导航</a>        </div>    </div>    <div class="h10"></div>	<table class="table table-bb">		<tr>            <th width="30">                <div class="custom-control custom-checkbox">                    <input type="checkbox" class="custom-control-input checkbox-all" id="checkbox-0">                    <label class="custom-control-label"  for="checkbox-0"></label>                </div>            </th>			<th width="60">ID</th>			<th>名称 / 英文</th>			<th width="360">URL路径</th>			<th>排序</th>			<th>是否显示</th>			<th>操作</th>		</tr>		<volist name='catelist' id='vo'>			<tr class="tr_{$vo.id}">                <td>                    <div class="custom-control custom-checkbox">                        <input type="checkbox" class="custom-control-input checkbox-item" id="checkbox-{$vo.id}" value="{$vo.id}" data-print-url="{:U('GoodsOrderPrint/print_view',array('id'=>$vo['id']))}" data-id="{$vo.id}">                        <label class="custom-control-label"  for="checkbox-{$vo.id}"></label>                    </div>                </td>				<td>{$vo.id}</td>				<td><notempty name="vo.name_cn">{$vo.pre}{$vo.name_cn}</notempty><notempty name="vo.name_en">&nbsp;/&nbsp;{$vo.name_en}</notempty></td>				<td onclick="return show_url_input(this);">					<span>{$vo.url}</span>					<input class="text text_max dis_none" type="text" data-old-url="{$vo.url}" value="{$vo.url}" onblur="return ajax_update_url(this,'{$vo.id}');" />				</td>				<td>                    <div class="form-inline">                        {$vo.pre}&nbsp;<input class="form-control form-control-sm w-40" type="text" name="sort" value="{$vo.sort}" old-sort="{$vo.sort}" data-id="{$vo.id}" sort-id="{$vo.id}" />&nbsp;                        <a class="blue" href="#" onclick="return update_sort({$vo.id},this)">更新</a>                    </div>				</td>				<td>					<switch name="vo.is_show">						<case value="0"><span class="badge badge-secondary">关闭</span></case>						<case value="1"><span class="badge badge-success">显示</span></case>					</switch>				</td>				<td>                    <a class="btn btn-sm btn-outline-secondary" href="{:U('Nav/edit',array('id'=>$vo['id']))}" role="button"><i class="fa fa-edit"></i> 编辑</a>                    <div class="btn-group" role="group">                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">                            更多                        </button>                        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">                            <a class="dropdown-item" href="#" onclick="return alert_win('{$vo.name_cn}',{$vo.id})"><i class="fa fa-plus"></i> 子分类</a>                            <eq name="vo.is_show" value="1">                                <a class="dropdown-item" href="#" onclick="return unshow_one('NavCate',{$vo.id})"><i class="fa fa-eye-slash"></i> 关闭</a>                                <else />                                <a class="dropdown-item" href="#" onclick="return show_one('NavCate',{$vo.id})"><i class="fa fa-eye"></i> 显示</a>                            </eq>                            <a class="dropdown-item" href="#" onclick="return cate_delete('{$vo.id}')"><i class="fa fa-trash"></i> 删除</a>                        </div>                    </div>				</td>			</tr>		</volist>	</table>    <div>        <button type="button" class="btn btn-secondary btn-sm" onclick="return update_sort();"><i class="fa fa-sort"></i> 排序</button>        <button type="button" class="btn btn-secondary btn-sm" onclick="return show_all('NavCate');"><i class="fa fa-eye"></i> 显示</button>        <button type="button" class="btn btn-secondary btn-sm" onclick="return unshow_all('NavCate');"><i class="fa fa-eye-slash"></i> 关闭</button>    </div><!--新增分类--><div id="as" style="display: none;">    <form action="{:U('Nav/add')}" method="post">        <div class="form-group">            <label>父级</label>            <span class="text-muted pl-2 js-pid"></span>        </div>        <input name="id" type="hidden" value="">        <div class="form-group">            <label><span class="text-danger">* </span>名称（中文）</label>            <input type="text" class="form-control" name="name_cn" placeholder="分类名称">            <small class="form-text text-muted">1-50个字符</small>        </div>        <div class="form-group">            <label>English</label>            <input type="text" class="form-control" name="name_en" placeholder="英文名称">            <small class="form-text text-muted">1-50个字符，选填</small>        </div>        <div class="form-group">            <label>url</label>            <input type="text" class="form-control" name="url" placeholder="url">            <small class="form-text text-muted"></small>        </div>        <div class="form-group">            <label>打开方式</label>            <select class="form-control" name="target">                <option value="_self" selected>_self</option>                <option value="_blank">_blank</option>            </select>            <small class="form-text text-muted">_self当前窗口，_blank新窗口</small>        </div>        <div class="form-group">            <label>是否显示</label>            <div>                <div class="custom-control custom-radio custom-control-inline">                    <input type="radio" id="is_show1" name="is_show" class="custom-control-input" value="1" checked>                    <label class="custom-control-label" for="is_show1">显示</label>                </div>                <div class="custom-control custom-radio custom-control-inline">                    <input type="radio" id="is_show2" name="is_show" class="custom-control-input" value="0">                    <label class="custom-control-label" for="is_show2">关闭</label>                </div>            </div>        </div>        <div class="h10"></div>        <div class="text-center">            <button type="submit" class="btn btn-primary">新增</button>        </div>    </form></div><script>    //弹出创建分类窗口    function alert_win(name,id){        $('.js-pid').text(name);        $('input[name=id]').val(id);        $boot.win({id:'#as','title':'新增分类'});        return false;    }	//显示网址输入框	function show_url_input(obj){		$(obj).find('span').hide();		$(obj).find('input').show().focus();		return false;	}	//更新网址	function ajax_update_url(obj,$id){		var old_url = $(obj).attr('data-old-url');		var this_url = $(obj).val();		if(this_url != old_url){			$.ajax({				type:"post",				url:"{:U('Nav/ajax_update_url')}",				data:{id:$id,url:this_url},				success:function(data){					if(data.status){						$(obj).parent().find('span').text(this_url).show();						$(obj).parent().find('input').attr({'data-old-url':this_url,'value':this_url}).hide();					}				}			});		}else{			$(obj).parent().find('span').show();			$(obj).parent().find('input').hide();		}	}	//删除分类提示	function cate_delete($id)	{		$boot.confirm({text:'确定删除此导航？',title:'删除导航'},function(){			$.ajax({				type:"post",				url:"{:U('Nav/ajax_del_cate')}",				data:{id:$id},				success:function(data){					if(data['status']){						$boot.success({text:"删除成功！"},function(){							for(i=0;i<data.ids.length;i++){								$(".tr_"+data['ids'][i]).remove();							}						});					}else{						$boot.error({text:data['error']});					}				}			});		});		return false;	}    //更新单条排序    function update_sort_one($id,obj){        var old_sort = $(obj).prev().attr('old-sort');        var now_sort = $(obj).prev().val();        if(old_sort == now_sort){            $boot.warn({text:"请先调整排序值！"});            return false;        }else{            $.ajax({                type:"post",                url:"{:U('Nav/ajax_setsort')}",                data:{id:$id,sort:now_sort},                success:function(data){                    if(data['status']){                        $boot.success({text:"更新成功！"},function(){                            window.location = window.location;                        });                    }                }            });        }        return false;    }    function update_sort(){        $last_id = $("input[name=sort]").last().attr('data-id');        $("input[name=sort]").each(function(){            var $id = $(this).attr('data-id'),$sort = $(this).val(),$old_sort = $(this).attr('old_sort');            if($old_sort!=$sort){                $.ajax({                    type:"post",                    url:"{:U('Nav/ajax_setsort')}",                    data:{id:$id,sort:$sort},                    success:function(data){                        if(data['status'] && $id == $last_id){                            $boot.success({text:"更新成功！",delay:1200},function(){                                window.location = window.location;                            });                        }                    }                });            }        });        return false;    }</script></block>