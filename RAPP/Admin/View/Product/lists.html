<extend name="Include:mother" /><block name="content"><div class="g_tab">	<div class="title">产品列表</div></div><div class="g_operation">	<div class="lft">		<form action="" method="get" name="form1">			选择分类：			<select class="select_group" name="cate_id">				<option value="">全部</option>				<volist name="catelist" id="item">					<eq name="item.is_able" value="1">						<option value="{$item.id}" <eq name="item.id" value="$Think.get.cate_id"> selected="selected" </eq> >{$item.pre}{$item.name}</option>					<else />						<option value="{$item.id}" <eq name="item.id" value="$Think.get.cate_id"> selected="selected" </eq> disabled="1">{$item.pre}{$item.name}</option>					</eq>				</volist>			</select>		</form>	</div>	<div class="rgt">		<div class="btn_group">			<dl>				<dd><a href="{:U('Product/add')}?cate_id={$cate_id}">新增产品</a></dd>			</dl>			<div class="clear"></div>		</div>	</div>	<div class="clear"></div></div><table class="g_list">	<tr>		<th width="40">ID</th>		<th>产品图片</th>		<th>产品标题</th>		<th>价格</th>		<th>特惠</th>		<th>排序</th>		<th>状态</th>		<th>操作</th>	</tr>	<volist name='alist' id='vo'>		<tr class="tr_{$vo.id}">			<td>{$vo.id}</td>			<td><img id="thumb_img_hide" src="{$vo['mainpic'][1]|img_rename='_min',###}" height="50" /></td>			<td>{$vo.title}</td>			<td><span class="line-through c666">￥{$vo.priceo}</span>&nbsp;&nbsp;&nbsp;<b class="orange">￥{$vo.price}</b></td>			<td>				<volist name="attach" id="voo">					<eq name="voo.id" value="$vo.attach">						<span class="tag">{$voo.name}</span>					</eq>				</volist>			</td>			<td>				<input class="text" type="text" name="sort" value="{$vo.sort}" old-sort="{$vo.sort}" data-id="{$vo.id}" style="width:40px;" />				<a href="#" onclick="return update_sort_one({$vo.id},this)">更新</a>			</td>			<td>				<volist name=":C('GOODS_STATUS')" id="voo">					<eq name="voo.key" value="$vo.status">						{$voo.value}					</eq>				</volist>			</td>			<td>				<a href="{:U('Product/edit',array('id'=>$vo['id'],'jump_url'=>array_encode($_GET)))}">编辑</a>&nbsp;&nbsp;&nbsp;				<a href="#" onclick="return del({$vo.id})">删除</a>			</td>		</tr>	</volist></table><div class="g_btns">	<a class="btn" href="#" onclick="return update_sort();">更新排序</a></div><div class="g_pages">	{$pages}</div><script>	//选择分类后提交表单	$("select.select_group").change(function(){		$("form[name=form1]").submit();	});	//ajax删除产品	function del($id){		$k.dialog({text:'确认删除？',title:'删除产品'},function(){			$.ajax({				type:"post",				url: "{:U('Product/ajax_del')}",				data: {id:$id},				success: function(data){					if(data)					{						$k.text({text:'删除成功！',delay:1200},function(){							$(".tr_"+$id).remove();						});					}else					{						$k.text({text:'删除失败！',delay:1200});					}				}			});		});		return false;	}	//更新单条排序	function update_sort_one($id,obj){		var old_sort = $(obj).prev().attr('old-sort');		var now_sort = $(obj).prev().val();		if(old_sort == now_sort){			$k.text({text:"请先调整排序值！",delay:1200});			return false;		}else{			$.ajax({				type:"post",				url:"{:U('Product/ajax_setsort')}",				data:{id:$id,sort:now_sort},				success:function(data){					if(data['status']){						$k.text({text:"更新成功！",delay:1200},function(){							window.location = window.location;						});					}				}			});		}		return false;	}	function update_sort(){		$last_id = $("input[name=sort]").last().attr('data-id');		$("input[name=sort]").each(function(){			var $id = $(this).attr('data-id'),$sort = $(this).val(),$old_sort = $(this).attr('old_sort');			if($old_sort!=$sort){				$.ajax({					type:"post",					url:"{:U('Product/ajax_setsort')}",					data:{id:$id,sort:$sort},					success:function(data){						if(data['status'] && $id == $last_id){							$k.text({text:"更新成功！",delay:1200},function(){								window.location = window.location;							});						}					}				});			}		});		return false;	}</script></block>