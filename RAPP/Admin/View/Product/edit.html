<extend name="Include:mother" /><block name="content"><div class="g_tab">	<div class="title">编辑产品</div>	<dl>		<dd class="on">基本信息</dd>		<dd>产品详情</dd>		<dd>轮播图片</dd>		<dd>附加属性</dd>	</dl>	<a href="{:U('Product/lists')}" class="link">返回产品列表</a></div><form action="{:U('Product/edit')}" method="post">	<input type="hidden" name="id" value="{$page.id}" />	<div class="main_b">		<table class="g_form">			<tr>				<td width="80" align="right"><b>产品分类：</b></td>				<td>					<select name="pid" id="itemsids">						<volist name="catelist" id="item">							<eq name="item.is_able" value="1">								<option value="{$item.id}" <eq name="item.id" value="$page.pid"> selected="selected" </eq> >{$item.pre}{$item.name}</option>								<else />								<option value="{$item.id}" <eq name="item.id" value="$page.pid"> selected="selected" </eq> disabled="1">{$item.pre}{$item.name}</option>							</eq>						</volist>					</select>				</td>			</tr>			<tr>				<td align="right"><b>产品名称：</b></td>				<td>					<input type="text" name="title" class="text text_max" value="{$page.title}"/>				</td>			</tr>			<tr>				<td align="right"><b>关键字：</b></td>				<td>					<input type="text" name="keywords" class="text text_max"						   value="{$page.keywords}"/>&nbsp;&nbsp;&nbsp;&nbsp;<a						class="orange" href="#" onclick="return split_words();">生成关键词</a>					<span class="tip">&nbsp;&nbsp;&nbsp;将标题生成关键词，不同关键字间用逗号”，“隔开</span>				</td>			</tr>			<tr>				<td align="right"><b>状态：</b></td>				<td>					<volist name=":C('GOODS_STATUS')" id="vo">						<eq name="vo.key" value="$page.status">							<label><input type="radio" name="status" value="{$vo.key}" checked="1" />&nbsp;{$vo.value}</label>&nbsp;&nbsp;&nbsp;							<else />							<label><input type="radio" name="status" value="{$vo.key}" />&nbsp;{$vo								.value}</label>&nbsp;&nbsp;&nbsp;						</eq>					</volist>				</td>			</tr>			<tr>				<td align="right"><b>原价：</b></td>				<td>					<input type="text" name="priceo" class="text text_min" value="{$page.priceo}"/>&nbsp;					<span class="tip">&nbsp;&nbsp;&nbsp;</span>				</td>			</tr>			<tr>				<td align="right"><b>现价：</b></td>				<td>					<input type="text" name="price" class="text text_min" value="{$page.price}"/>&nbsp;				</td>			</tr>			<tr>				<td align="right"><b>特惠：</b></td>				<td>					<select name="attach">						<option value="0">--请选择--</option>						<volist name="attach" id="vo">							<eq name="vo.id" value="$page.attach">								<option value="{$vo.id}" selected="1">{$vo.name}</option>							<else />								<option value="{$vo.id}">{$vo.name}</option>							</eq>						</volist>					</select>					&nbsp;&nbsp;&nbsp;<a class="blue" href="#" onclick="return parent.window.alert_iframe('产品特惠','{:U('ProductAttach/lists;')}','{:md5(U(';ProductAttach/lists;'))}';)">特惠说明</a>				</td>			</tr>			<tr>				<td align="right"><b>规格：</b></td>				<td>					<input type="text" name="norms" class="text text_max" value="{$page.norms}"/>&nbsp;					元/<span class="price_unit">kg</span>					<span class="tip">&nbsp;&nbsp;&nbsp;出售价格以现价为准</span>				</td>			</tr>			<!--			<tr>				<td align="right"><b>可选属性：</b></td>				<td>					<div  class="bgf7 pb10">						<div class="com_goods_mainattr">							<input type="hidden" name="mainattr"/>							<ul>								<volist name="page.mainattr" id="vo" key="key">									<eq name="key" value="1">										<li><input class="text text_min mainattr_name" type="text" value="{$vo.name}"/>&nbsp;<input class="text text_max mainattr_value" type="text" value="{$vo.value}"/>&nbsp;&nbsp;<a class="blue" href="#" onclick="return add_mainattr_li();">新增一栏</a>&nbsp;&nbsp;&nbsp;<span class="tip">增加可选属性，多个属性值请用逗号","隔开</span></li>										<else />										<li><input class="text text_min mainattr_name" type="text" value="{$vo.name}"/>&nbsp;<input class="text text_max mainattr_value" type="text" value="{$vo.value}"/>&nbsp;&nbsp;<a class="blue" href="#" onclick="return del_mainattr_li(this);">删除</a></li>									</eq>								</volist>							</ul>						</div>					</div>					<script>						function add_mainattr_li(){							var str = '<li><input class="text text_min mainattr_name" type="text" />&nbsp;<input class="text text_max mainattr_value" type="text" />&nbsp;&nbsp;<a class="blue" href="#" onclick="return del_mainattr_li(this);">删除</a></li>';							$(str).appendTo(".com_goods_mainattr ul");							return false;						}						function del_mainattr_li(obj){							$k.dialog({text:"确认删除？"},function(){								$(obj).parent().remove();							});							return false;						}					</script>				</td>			</tr>			-->			<tr>				<td align="right"><b>SEO描述：</b></td>				<td>					<textarea name="description">{$page.description}</textarea>				</td>			</tr>			<tr>				<td align="right"><b></b></td>				<td>				</td>			</tr>		</table>	</div>	<div class="main_b">		<table class="g_form">			<tr>				<td width="80" align="right" valign="top">					<b>产品详情：</b>					<div class="g_editsize">						<volist name="editsize" id="vo" key="k">							<eq name="k" value="1">								<div class="size_item"><a class="on" href="#">{$vo}</a></div>								<else />								<div class="size_item"><a href="#">{$vo}</a></div>							</eq>						</volist>					</div>				</td>				<td>					<textarea id="redactor_content" name="body" style="height:500px;width:100%;position: relative;z-index:1;" >{$page.body}</textarea>				</td>			</tr>		</table>	</div>	<div class="main_b">		<table class="g_form">			<tr>				<td width="80" align="right"><b>轮播图片：</b></td>				<td>					<include file="Include/upload_img_goods" inputid="upload_img_goods" inputname="mainpic" size="2"							 tip=" " mid_size="350,350" min_size="100,100" />				</td>			</tr>		</table>	</div>	<div class="main_b">		<div class="g_form">			<input type="hidden" name="extattr" value="">			<volist name="attrlist" id="vo">				<eq name="vo.widget" value="input_text">					<div class="formitem">						<div class="lft">{$vo.title}：</div>						<div class="rgt">							<input type="text" name="{$vo.identify}" class="text attr_serialize" data-title="{$vo.title}" data-widget="{$vo.widget}" value="{$vo.value}"/>							<span class="tip">&nbsp;&nbsp;&nbsp;{$vo.remark}</span>						</div>					</div>				</eq>				<eq name="vo.widget" value="textarea">					<div class="formitem">						<div class="lft">{$vo.title}：</div>						<div class="rgt">							<textarea name="{$vo.identify}" class="textarea attr_serialize" data-title="{$vo.title}" data-widget="{$vo.widget}">{$vo.value}</textarea>							<span class="tip">&nbsp;&nbsp;&nbsp;{$vo.remark}</span>						</div>					</div>				</eq>			</volist>		</div>	</div>	<div class="g_submit_panel">		<div class="formitem">			<div class="lft"></div>			<div class="rgt">				<input type="submit" class="submit" value="保存" />			</div>		</div>	</div></form><script>	//保存附加字段	$("input.submit").click(function(){		//js计算附加属性		var $array = [],$json = {};		for(i=0;i<$(".attr_serialize").length;i++){			$json['title'] = $(".attr_serialize").eq(i).attr('data-title');			$json['identify'] = $(".attr_serialize").eq(i).attr('name');			$json['widget'] = $(".attr_serialize").eq(i).attr('data-widget');			$json['value'] = $(".attr_serialize").eq(i).val();			$array.push($json);			$json = {};		}		var str = JSON.stringify($array);		$("input[name=extattr]").val(str);		//js计算主属性值		var $array2 = [],$json2 = {},$obj = $(".com_goods_mainattr");		for(i=0;i<$obj.find('li').length;i++){			$json2['name'] = $obj.find('.mainattr_name').eq(i).val();			$json2['value'] = $obj.find('.mainattr_value').eq(i).val();			$array2.push($json2);			$json2 = {};		}		var str2 = JSON.stringify($array2);		$("input[name=mainattr]").val(str2);	});	//分类切换（需要刷新附加属性），ajax更新分类后刷新页面	$("#itemsids").change(function(){		var $pid=$(this).children('option:selected').val();		var $id = $("input[name=id]").val();		$.ajax({			type:"post",			url:"{:U('Product/ajax_update_pid')}",			data:{id:$id,pid:$pid},			success:function(data){				if(data.status){					window.location = "{:U('Product/edit')}"+"?cate_id="+$pid+"&id="+$id;				}			}		});	});	//选项卡切换	$(".main_b").hide().eq(0).show();	$(".g_tab dd").click(function(){		var num = $(".g_tab dd").index(this);		$(this).addClass("on").siblings().removeClass("on");		$(".main_b").hide().eq(num).show();		return false;	});	//关键字分词	function split_words(){		$title = $("input[name=title]").val();		if($title == ''){			$k.text({text:"请先输入产品名称！",delay:1200});			return false;		}		$.ajax({			type:"post",			url:"{:U('Article/ajax_split_words')}",			data:{title:$title},			success:function(data){				if(data['status']){					$("input[name=keywords]").val(data['keywords']);				}			}		});		return false;	}	//实例化编辑器	var editor = UE.getEditor('redactor_content');	//改变编辑器大小	$(".g_editsize .size_item a").click(function(){		$(".g_editsize .size_item a").removeClass('on');		$(this).addClass('on');		var $val = $(this).text();		if($val == '100%'){			$val = $("body").width()-100;		}		var $content = editor.getContent();		editor.destroy();		editor = UE.getEditor('redactor_content',{			'initialContent':$content,			'initialFrameWidth':$val		});		return false;	});</script></block>