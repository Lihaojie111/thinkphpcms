<a class="blue" href="#" onclick="return alert_goods_choose();">选择商品</a><div class="com-activity-goods">    <input name="goods_ids" type="hidden" value="{$page.goods_ids}" />    <ul>        <include file="Fetch/fetch_goods_list" />    </ul>    <div class="clear"></div></div><style>    /*商品活动添加组件*/    .com-activity-goods{}    .com-activity-goods ul{}    .com-activity-goods ul li{ width:300px; height: 80px; float: left; margin: 10px 10px 0 0;border:#eee 1px solid; overflow: hidden; position: relative;}    .com-activity-goods ul li a.delete{position:absolute;right:0px;top:0px;display:inline-block;height:16px;line-height:16px;width:16px;text-align:center;background:#999;color:#fff; cursor: pointer;}    .com-activity-goods ul li a.prev{position:absolute;right:18px;bottom:0px;display:inline-block;height:16px;line-height:12px;width:16px;text-align:center;background:#999;color:#fff;}    .com-activity-goods ul li a.prev:hover{text-decoration:none;}    .com-activity-goods ul li a.next{position:absolute;right:0px;bottom:0px;display:inline-block;height:16px;line-height:12px;width:16px;text-align:center;background:#999;color:#fff;}    .com-activity-goods ul li a.next:hover{text-decoration:none;}    .com-activity-goods ul li a.pic{ float: left;width:80px; height: 80px; overflow: hidden;}    .com-activity-goods ul li a.pic img{ width: 80px; height: 80px;}    .com-activity-goods ul li .right{ width:180px; float: right;padding:0 30px 0 0;}    .com-activity-goods ul li .right .title{line-height: 18px;margin:8px 0 0 0;}    .com-activity-goods ul li .right .price{ height: 20px; line-height: 20px; overflow: hidden;}</style><script>    /*判断n是否在数组arr中*/    function array_merge_unique(n,arr)    {        for(var i=0;i<arr.length;i++)        {            if(n==arr[i]){                return true;            }        }        return false;    }    //弹出商品选择组件    var $iframe;    function alert_goods_choose(){        var h =　$(window).height(),w = $(window).width();        var location = "{:U('Goods/choose',array('goods_ids'=>urlencode($ids)))}";        $iframe = $.iframe({width:w-300,height:h-100,location:location,title:"选择商品"});        return false;    }    //ajax添加商品    function add_goods($ids){        //$iframe.drop();        var now_arr = $("input[name=goods_ids]").val(), now_ids = now_arr;        now_arr = now_arr.split(',');        var ids = "";        var new_arr = $ids.split(',');        for(i=0;i<new_arr.length;i++){            if(!array_merge_unique(new_arr[i],now_arr)){                ids += new_arr[i]+",";            }        }        ids = ids.substring(0,ids.length-1);        if(!ids){            $.ktext("请勿重复添加！");return false;        }        $.ajax({            type:"post",            url: "{:U('Activity/ajax_add_goods')}",            data: {ids:ids},            success: function(data){                if(data.status)                {                    $(".com-activity-goods ul").append(data.data);                    ids = get_now_ids();                    $("input[name=goods_ids]").val(ids);                }else                {                    $.ktext({text:'添加失败！',delay:1200});                }            }        });    }    //ajax删除商品组件    function del_activity_goods(id,obj){        $.confirm('确认删除该商品？',function(){            $(obj).parent().remove();            var ids = get_now_ids();            $("input[name=goods_ids]").val(ids);        });        return false;    }    //商品前移    function move_prev(obj){        var $index = $(obj).parent().prevAll().length;        if($index != 0){            var $target = $(obj).parent().prev();            $(obj).parent().insertBefore($target);        }        var ids = get_now_ids();        $("input[name=goods_ids]").val(ids);        return false;    }    //商品后移    function move_next(obj){        var $index = $(obj).parent().nextAll().length;        if($index != 0){            var $target = $(obj).parent().next();            $(obj).parent().insertAfter($target);        }        var ids = get_now_ids();        $("input[name=goods_ids]").val(ids);        return false;    }    //结算当前所有商品id，准备赋值给input    function get_now_ids(){        var ids = "";        $(".com-activity-goods ul li").each(function(){            ids += $(this).attr('data-id')+',';        });        ids = ids.substring(0,ids.length-1);        return ids;    }</script>