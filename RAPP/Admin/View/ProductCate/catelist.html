<extend name="Include:mother" /><block name="content"><div class="g_tab">	<div class="title">商品分类</div></div><div class="g_operation">	<div class="rgt">		<div class="btn_group">			<dl>				<dd><a href="#" onclick="return alert_sort(0,'根目录');">添加顶级分类</a></dd>			</dl>			<div class="clear"></div>		</div>	</div>	<div class="clear"></div></div><form name="" action="" method="post">	<input type="hidden" name="act" value="update_order">	<table class="g_list">		<thead>		<tr>			<th width="60">ID</th>			<th width="240">分类名（商品数）</th>			<th>排序</th>			<th>操作</th>		</tr>		</thead>		<tbody>		<volist name='catelist' id='vo'>			<tr class="tr_{$vo.id}">				<td>{$vo.id}</td>				<td>{$vo.pre}{$vo.name}<eq name="vo.is_able" value="1">({$vo.total})</eq></td>				<td>					{$vo.pre}<input class="text" type="text" name="sort" value="{$vo.sort}" old-sort="{$vo.sort}" data-id="{$vo.id}" style="width:40px;" />					<a href="#" onclick="return update_sort_one({$vo.id},this)">更新</a>				</td>				<td>					<a href="{:U('ProductCate/edit',array('id'=>$vo['id']))}">编辑分类</a>&nbsp;&nbsp;&nbsp;					<a href="#" onclick="return alert_sort({$vo.id},'{$vo.name}')">添加子分类</a>&nbsp;&nbsp;&nbsp;					<eq name="vo.is_able" value="1">					<a href="{:U('Product/lists',array('cate_id'=>$vo['id']))}">内容</a>&nbsp;&nbsp;&nbsp;					</eq>					<a href="#" onclick="return cate_delete({$vo.id})">删除</a>				</td>			</tr>		</volist>		</tbody>	</table></form><div class="g_btns">	<a class="btn" href="#" onclick="return update_sort();">更新排序</a></div><div class="add_sort">	<div class="add_sort_head"><a class="close">×</a></div>	<form action="{:U('ProductCate/add')}" method="post">		<table>			<tr>				<td width="80" align="right">父类：<input type="hidden" name="id" value=""></td>				<td><span class="sort_name"></span></td>			</tr>			<tr>				<td align="right">名称：</td>				<td><input type="text" class="text" name="name" /></td>			</tr>			<tr>				<td></td>				<td><input name="submit" type="submit" value="添加" /></td>			</tr>		</table>	</form></div><script>	function alert_sort(id,name){		var w=$(window).width(),h=$("body").height()>$(window).height()?$("body").height():$(window).height();		$(".add_sort").find(".sort_name").text(name);		$(".add_sort").find("input[name=id]").attr("value",id);		$(".add_sort").css({left:w/2-150,top:$(window).height()/2-100+$(window).scrollTop()}).show();		return false;	}	$(".add_sort_head a.close").click(function(){		$(this).parents(".add_sort").hide();		return false;	});	//删除分类提示	function cate_delete($id)	{		$k.dialog({text:'确定删除此分类？',title:'删除分类'},function(){			$.ajax({				type:"post",				url:"{:U('ProductCate/ajax_del_cate')}",				data:{id:$id},				success:function(data){					if(data['status']){						$k.text({text:"删除成功！",delay:1200},function(){							for(i=0;i<data.ids.length;i++){								$(".tr_"+data['ids'][i]).remove();							}						});					}else{						$k.text({text:data['error'],delay:1200});					}				}			});		});		return false;	}	//更新单条排序	function update_sort_one($id,obj){		var old_sort = $(obj).prev().attr('old-sort');		var now_sort = $(obj).prev().val();		if(old_sort == now_sort){			$k.text({text:"请先调整排序值！",delay:1200});			return false;		}else{			$.ajax({				type:"post",				url:"{:U('ProductCate/ajax_setsort')}",				data:{id:$id,sort:now_sort},				success:function(data){					if(data['status']){						$k.text({text:"更新成功！",delay:1200},function(){							window.location = window.location;						});					}				}			});		}		return false;	}	function update_sort(){		$last_id = $("input[name=sort]").last().attr('data-id');		$("input[name=sort]").each(function(){			var $id = $(this).attr('data-id'),$sort = $(this).val(),$old_sort = $(this).attr('old_sort');			if($old_sort!=$sort){				$.ajax({					type:"post",					url:"{:U('ProductCate/ajax_setsort')}",					data:{id:$id,sort:$sort},					success:function(data){						if(data['status'] && $id == $last_id){							$k.text({text:"更新成功！",delay:1200},function(){								window.location = window.location;							});						}					}				});			}		});		return false;	}</script><style>	.add_sort{position:absolute;left:-9999px;top:0px;width:400px;height:200px;border:#ccc 1px solid;background:#fff;box-shadow:0 0 4px rgba(0,0,0,0.3)}	.add_sort_head{height:40px;position:relative;background:#eee;}	.add_sort_head a.close{display:block;width:20px;height:20px;line-height:20px;text-align:center;color:#999;position:absolute;right:10px;top:10px;font-size:24px;cursor:pointer;}	.add_sort_head a.close:hover{color:#000;text-decoration:none;}	.add_sort table{width:345px;margin:20px auto 0 auto;}	.add_sort table td{padding:4px;}</style></block>